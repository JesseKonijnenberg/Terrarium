<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:Terrarium.Avalonia.ViewModels"
             xmlns:views="using:Terrarium.Avalonia.Views"
             xmlns:behaviors="using:Terrarium.Avalonia.Behaviors"
             xmlns:kanban="clr-namespace:Terrarium.Avalonia.Models.Kanban"
             xmlns:helpers="clr-namespace:Terrarium.Avalonia.Helpers"
             x:Class="Terrarium.Avalonia.Controls__UI_Components_.TaskCardControl"
             x:DataType="kanban:TaskItem">
    
    <UserControl.Resources>
        <helpers:PriorityToColorConverter x:Key="PriorityToColorConverter"/>
    </UserControl.Resources>
    
    <UserControl.Styles>
        <Style Selector="Border.TaskCard">
            <Setter Property="Background" Value="{DynamicResource BgCard}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource BorderColor}"/>
            <Setter Property="BorderThickness" Value="4,0,0,0"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="20"/>
            <Setter Property="Margin" Value="0,0,0,12"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="HorizontalAlignment" Value="Stretch"/>
        </Style>
        <Style Selector="Border.TaskCard:pointerover">
            <Setter Property="Background" Value="{DynamicResource BgCardHover}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource AccentSage}"/>
        </Style>
        <Style Selector="Border.TaskCard.IsSelected">
            <Setter Property="BorderBrush" Value="{DynamicResource AccentSage}"/>
            <Setter Property="BorderThickness" Value="4"/>
            <Setter Property="BoxShadow" Value="0 0 15 0 #408694"/> 
        </Style>
    </UserControl.Styles>

    <Border Classes="TaskCard"
            Classes.IsSelected="{Binding IsSelected}"
            behaviors:BoardInteractions.StopPropagation="True"
            behaviors:KanbanDragHandler.IsDraggable="True"
            behaviors:KanbanDragHandler.Command="{Binding $parent[views:KanbanBoardView].((vm:KanbanBoardViewModel)DataContext).ToggleTaskSelectionCommand}">
        
        <Grid RowDefinitions="Auto, Auto, Auto"
              Background="Transparent"
              behaviors:BoardInteractions.CommandOnRightClick="{Binding $parent[views:KanbanBoardView].((vm:KanbanBoardViewModel)DataContext).OpenTaskCommand}"
              behaviors:BoardInteractions.CommandParameter="{Binding .}">
            
            <Border HorizontalAlignment="Left" Background="{Binding TagBgColor}" BorderBrush="{Binding TagBorderColor}" BorderThickness="1" CornerRadius="10" Padding="12,2" Margin="0,0,0,12">
                <TextBlock Text="{Binding Tag}" Foreground="{Binding TagTextColor}" FontSize="10" FontWeight="Bold"/>
            </Border>
            
            <TextBlock Grid.Row="1" Text="{Binding Title}" Foreground="#d6ccc2" FontSize="14" TextWrapping="Wrap" Margin="0,0,0,16"/>
            
            <Grid Grid.Row="2" ColumnDefinitions="Auto, *">
                <TextBlock Text="{Binding DueDate, StringFormat=\{0:MMM dd\}}" Foreground="{DynamicResource TextMuted}" FontSize="11"/>
                <Ellipse Grid.Column="1" 
                         HorizontalAlignment="Right" 
                         Width="8" Height="8"
                         Fill="{Binding Priority, Converter={StaticResource PriorityToColorConverter}}"/>
            </Grid>
        </Grid>
    </Border>
</UserControl>