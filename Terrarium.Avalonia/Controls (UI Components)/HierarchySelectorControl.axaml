<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:Terrarium.Avalonia.ViewModels"
             x:Class="Terrarium.Avalonia.Controls.HierarchySelectorControl"
             x:DataType="vm:HierarchyViewModel">

    <UserControl.Styles>
        <Style Selector="ContextMenu">
            <Setter Property="Background" Value="{DynamicResource BgCard}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="{DynamicResource BorderColor}"/>
        </Style>
        
        <Style Selector="Button.HierarchyBtn:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="{DynamicResource BgCard}"/>
        </Style>
    </UserControl.Styles>

    <StackPanel Spacing="0">
        
        <Button Width="48" Height="48" CornerRadius="14" 
                HorizontalAlignment="Left" Margin="10,0,0,28"
                Background="{DynamicResource BgCard}" BorderBrush="{DynamicResource AccentSage}" BorderThickness="2">
            <TextBlock Text="{Binding SelectedOrgInitial}" Foreground="{DynamicResource AccentSage}" 
                       FontWeight="Black" FontSize="20" HorizontalAlignment="Center" VerticalAlignment="Center"/>
            <Button.Flyout>
                <Flyout Placement="BottomEdgeAlignedLeft">
                    <Grid RowDefinitions="*, Auto">
                        <ListBox Grid.Row="0" ItemsSource="{Binding Organizations}" SelectedItem="{Binding SelectedOrganization}">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding Name}" Padding="8"/>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                        <Button Grid.Row="1" Content="+ New Organization" 
                                Command="{Binding CreateOrganizationCommand}"
                                HorizontalAlignment="Stretch" Background="Transparent" Opacity="0.7"/>
                    </Grid>
                </Flyout>
            </Button.Flyout>
        </Button>

        <Button Classes="HierarchyBtn" Margin="0,0,0,4"
                Background="Transparent" BorderThickness="0"
                HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch"
                Padding="12,10" CornerRadius="8">
            
            <Button.Flyout>
                <Flyout Placement="BottomEdgeAlignedLeft">
                    <Grid RowDefinitions="*, Auto">
                        <ListBox Grid.Row="0" ItemsSource="{Binding Workspaces}" SelectedItem="{Binding SelectedWorkspace}">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding Name}" Padding="8"/>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                        <Button Grid.Row="1" Content="+ New Workspace" 
                                Command="{Binding CreateWorkspaceCommand}"
                                HorizontalAlignment="Stretch" Background="Transparent" Opacity="0.7"/>
                    </Grid>
                </Flyout>
            </Button.Flyout>

            <Grid ColumnDefinitions="*, Auto">
                <TextBlock Text="{Binding SelectedWorkspace.Name, FallbackValue='Select Workspace'}" 
                           FontSize="14" FontWeight="SemiBold" VerticalAlignment="Center"/>
                
                <Path Grid.Column="1" Data="M19 9l-7 7-7-7" 
                      Stroke="{DynamicResource TextMuted}" StrokeThickness="2" 
                      Width="10" Height="10" Stretch="Uniform" Margin="8,0,0,0"/>
            </Grid>
        </Button>

        <Border Margin="18,0,0,32" 
                BorderBrush="{DynamicResource BorderColor}" 
                BorderThickness="1.5,0,0,0" 
                Padding="12,0,0,0">
            
            <Button Classes="HierarchyBtn" Padding="8,6" CornerRadius="6"
                    Background="Transparent" BorderThickness="0"
                    HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch">
                
                <Button.Flyout>
                    <Flyout Placement="BottomEdgeAlignedLeft">
                        <Grid RowDefinitions="*, Auto">
                            <ListBox Grid.Row="0" ItemsSource="{Binding Projects}" SelectedItem="{Binding SelectedProject}">
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <Grid Background="Transparent">
                                            <Grid.ContextMenu>
                                                <ContextMenu>
                                                    <MenuItem Header="Delete Project" 
                                                              Command="{Binding $parent[UserControl].((vm:HierarchyViewModel)DataContext).DeleteProjectCommand}"
                                                              CommandParameter="{Binding .}"
                                                              Foreground="#FF5555"/>
                                                </ContextMenu>
                                            </Grid.ContextMenu>
                                            <TextBlock Text="{Binding Name}" Padding="8" FontSize="13"/>
                                        </Grid>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>
                            
                            <Button Grid.Row="1" 
                                    Command="{Binding CreateProjectCommand}"
                                    HorizontalAlignment="Stretch" 
                                    HorizontalContentAlignment="Left"
                                    Background="Transparent" BorderThickness="0" Padding="10,8">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <TextBlock Text="+" Foreground="{DynamicResource AccentSage}"/>
                                    <TextBlock Text="Create New Project..." FontStyle="Italic" Opacity="0.7" FontSize="12"/>
                                </StackPanel>
                            </Button>
                        </Grid>
                    </Flyout>
                </Button.Flyout>

                <Grid ColumnDefinitions="*, Auto">
                    <TextBlock Text="{Binding SelectedProject.Name, FallbackValue='Select Project'}" 
                               FontSize="12" Foreground="{DynamicResource TextMuted}" VerticalAlignment="Center"/>
                    
                    <Path Grid.Column="1" Data="M19 9l-7 7-7-7" 
                          Stroke="{DynamicResource TextMuted}" StrokeThickness="2" 
                          Width="10" Height="10" Stretch="Uniform" Margin="8,0,0,0"/>
                </Grid>
            </Button>
        </Border>
        
    </StackPanel>
</UserControl>