<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:Terrarium.Avalonia.ViewModels"
             x:Class="Terrarium.Avalonia.Controls.UpdateStatusControl"
             x:DataType="vm:KanbanBoardViewModel">

    <UserControl.Resources>
        <Geometry x:Key="IconDownload">M12,16 L12,8 M9,11 L12,14 L15,11 M5,18 L19,18</Geometry>
        <Geometry x:Key="IconCancel">M18,6 L6,18 M6,6 L18,18</Geometry>
    </UserControl.Resources>

    <UserControl.Styles>
        <Style Selector="Button.Icon">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="Template">
                <ControlTemplate>
                    <Grid Background="{TemplateBinding Background}">
                        <Path Data="{Binding Content, RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource ObjToGeom}}" 
                              Stroke="{StaticResource TextMuted}" StrokeThickness="2" 
                              Fill="Transparent" Width="10" Height="10" Stretch="Uniform"
                              HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </Grid>
                </ControlTemplate>
            </Setter>
        </Style>
        <Style Selector="Button.Icon:pointerover /template/ Path">
            <Setter Property="Stroke" Value="#E57373"/> </Style>

        <Style Selector="Button.UpdateBtn">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Padding" Value="0"/>
        </Style>
        <Style Selector="Button.UpdateBtn:pointerover Path">
            <Setter Property="Stroke" Value="{StaticResource AccentSage}"/>
        </Style>
        <Style Selector="Button.UpdateBtn:pointerover TextBlock">
            <Setter Property="Foreground" Value="{StaticResource AccentSage}"/>
        </Style>
    </UserControl.Styles>

    <Panel>
        <Button Classes="UpdateBtn"
                IsVisible="{Binding !IsUpdating}"
                IsEnabled="{Binding IsUpdateAvailable}"
                Command="{Binding UpdateCommand}">
            
            <StackPanel Spacing="5" IsVisible="{Binding IsUpdateAvailable}">
                    <Grid HorizontalAlignment="Center">
                    <Path Data="{StaticResource IconDownload}" 
                            Stroke="{StaticResource TextMuted}" StrokeThickness="2" 
                            Width="20" Height="20"
                            HorizontalAlignment="Center" VerticalAlignment="Center"/>
                </Grid>
                <TextBlock Text="{Binding UpdateButtonText}"
                            Foreground="{StaticResource TextMuted}"
                            FontSize="9" FontWeight="Bold"
                            TextAlignment="Center" TextWrapping="Wrap"
                            MaxWidth="60" HorizontalAlignment="Center"/>
            </StackPanel>
        </Button>

        <StackPanel Spacing="5" IsVisible="{Binding IsUpdating}">
            
            <StackPanel Orientation="Horizontal" Spacing="8" HorizontalAlignment="Center">
                
                <ProgressBar Theme="{DynamicResource FluentProgressBar}"
                                Minimum="0" Maximum="100"
                                Value="{Binding UpdateProgress}"
                                Width="16" Height="16"
                                MinWidth="16" MinHeight="16"
                                MaxWidth="16" MaxHeight="16"
                                Margin="0" Padding="0"
                                IsIndeterminate="False" ShowProgressText="False"
                                Foreground="{StaticResource AccentSage}"/>

                <Button Classes="Icon" 
                        Command="{Binding CancelUpdateCommand}"
                        Content="{StaticResource IconCancel}"
                        ToolTip.Tip="Cancel Update"
                        Width="16" Height="16"/>
            </StackPanel>

            <TextBlock Text="{Binding UpdateButtonText}"
                        Foreground="{StaticResource TextMuted}"
                        FontSize="9" FontWeight="Bold"
                        TextAlignment="Center" TextWrapping="Wrap"
                        MaxWidth="60" HorizontalAlignment="Center"/>
        </StackPanel>
    </Panel>
</UserControl>